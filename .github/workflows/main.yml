name: Minecraft Server First Login

on:
  workflow_dispatch:

jobs:
  auth:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install Python & PyDrive
        run: |
          sudo apt-get update
          sudo apt-get install -y python3 python3-pip
          pip3 install PyDrive

      - name: Create client_secrets.json (نوع web)
        run: |
          cat > client_secrets.json <<'JSON'
          {
            "web": {
              "client_id": "1075710372669-cbfkadsv6bih8svdr61nc2ckvp2p64tv.apps.googleusercontent.com",
              "project_id": "server-472112",
              "auth_uri": "https://accounts.google.com/o/oauth2/auth",
              "token_uri": "https://oauth2.googleapis.com/token",
              "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
              "client_secret": "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",
              "redirect_uris": [
                "http://localhost:8080/",
                "http://127.0.0.1:8080/"
              ]
            }
          }
          JSON

      - name: Run OAuth to generate credentials.json
        run: |
          python3 - <<'PY'
          from pydrive.auth import GoogleAuth
          import os

          gauth = GoogleAuth()
          gauth.LoadClientConfigFile("client_secrets.json")

          if not os.path.exists("credentials.json"):
              gauth.LocalWebserverAuth()
              gauth.SaveCredentialsFile("credentials.json")
              print("✅ credentials.json generated")
          else:
              print("⚡ credentials.json already exists")
          PY

      - name: Upload credentials.json as artifact
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: credentials
          path: credentials.json
