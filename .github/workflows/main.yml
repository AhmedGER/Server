name: ğŸš€ Google Drive Workflow

on:
  workflow_dispatch:

jobs:
  google-drive-test:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›ï¸ Checkout repo
        uses: actions/checkout@v3

      - name: ğŸ“¦ Install dependencies
        run: |
          python3 -m pip install --upgrade pip
          pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client jq

      # 1ï¸âƒ£ ÙŠØ´ÙˆÙ service_account.json
      - name: ğŸ” Step 1 - Check if service_account.json exists
        run: |
          if [ -f "service_account.json" ]; then
            echo "âœ… Found service_account.json"
          else
            echo "âŒ File not found!"
            exit 1
          fi

      # 2ï¸âƒ£ ÙŠØ·Ø¨Ø¹ Ø§Ù„Ù€ private key
      - name: ğŸ”‘ Step 2 - Print private key
        run: |
          cat service_account.json | jq -r .private_key

      # 3ï¸âƒ£ ÙŠØªØ£ÙƒØ¯ Ø¥Ù† JSON Ø³Ù„ÙŠÙ…
      - name: âœ… Step 3 - Validate JSON
        run: |
          python3 - <<'PY'
          import json
          try:
              with open("service_account.json") as f:
                  data = json.load(f)
              print("âœ… JSON is valid")
          except Exception as e:
              print("âŒ JSON Error:", e)
              exit(1)
          PY

      # 4ï¸âƒ£ ÙŠØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ ÙŠÙ‚Ø¯Ø± ÙŠØªØµÙ„ Ø¨Ù€ Google
      - name: ğŸ” Step 4 - Authenticate with Google
        run: |
          python3 - <<'PY'
          from google.oauth2 import service_account
          from googleapiclient.discovery import build

          scopes = ["https://www.googleapis.com/auth/drive"]
          creds = service_account.Credentials.from_service_account_file("service_account.json", scopes=scopes)
          service = build("drive", "v3", credentials=creds, cache_discovery=False)

          about = service.about().get(fields="user").execute()
          print("âœ… Authenticated as:", about["user"]["displayName"], "-", about["user"]["emailAddress"])
          PY

      # 5ï¸âƒ£ Ø¨Ø¯Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª â†’ ÙŠØ¹Ù…Ù„ ÙÙˆÙ„Ø¯Ø±
      - name: ğŸ“‚ Step 5 - Create folder in Google Drive
        run: |
          python3 - <<'PY'
          from google.oauth2 import service_account
          from googleapiclient.discovery import build

          scopes = ["https://www.googleapis.com/auth/drive"]
          creds = service_account.Credentials.from_service_account_file("service_account.json", scopes=scopes)
          service = build("drive", "v3", credentials=creds, cache_discovery=False)

          folder_metadata = {
              "name": "WorkflowTestFolder",
              "mimeType": "application/vnd.google-apps.folder"
          }
          folder = service.files().create(body=folder_metadata, fields="id").execute()
          print("ğŸ“‚ Folder created with ID:", folder.get("id"))
          PY
