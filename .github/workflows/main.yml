name: Minecraft Server Test

on:
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ

jobs:
  run-server:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Java 16
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 16

      - name: Install expect
        run: sudo apt-get update && sudo apt-get install -y expect

      - name: Run server with auto-stop after 15 minutes
        run: |
          cat > run-server.exp <<'EOF'
          #!/usr/bin/expect -f
          set timeout 900        ;# 900 Ø«Ø§Ù†ÙŠØ© = 15 Ø¯Ù‚ÙŠÙ‚Ø©
          spawn java -Xmx16G -Xms12G -jar server.jar --nogui
          expect {
            timeout { send "stop\r" }
          }
          expect eof
          EOF
          chmod +x run-server.exp
          ./run-server.exp

      # ðŸŸ¢ Ø­ÙØ¸ Ø§Ù„Ø¹ÙˆØ§Ù„Ù…
      - name: Upload Worlds
        uses: actions/upload-artifact@v4
        with:
          name: worlds-backup
          path: |
            world
            world_nether
            world_the_end

      # ðŸŸ¢ Ø­ÙØ¸ Ø§Ù„Ù€ Plugins
      - name: Upload Plugins
        uses: actions/upload-artifact@v4
        with:
          name: plugins-backup
          path: plugins

      # ðŸŸ¢ Ø­ÙØ¸ Ù…Ù„ÙØ§Øª ØªØ§Ù†ÙŠØ© Ù…Ù‡Ù…Ø© (configs, logs, Ø¥Ù„Ø®)
      - name: Upload Configs and Logs
        uses: actions/upload-artifact@v4
        with:
          name: configs-logs-backup
          path: |
            server.properties
            bukkit.yml
            spigot.yml
            paper.yml
            logs
